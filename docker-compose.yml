version: '3.8'

services:
  # MongoDB service
  mongodb:
    image: mongo:latest
    container_name: mongodb
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=adminpassword
      - MONGO_INITDB_DATABASE=travila
    volumes:
      - mongodb_data:/data/db
    ports:
      - "27017:27017"
    networks:
      - app_network

  # Backend (Node.js / Express) service
  backend:
    build: ./backend
    container_name: backend
    environment:
      - MONGO_URI=mongodb://mongodb:27017/travila
      - PORT=3001
      - NODE_ENV=development
      - JWT_EXPIRES_IN=30d
      - JWT_SECRET=4f897269be0b378bcd702b6272acb7d97edeee9da4b3f3c754329ff9c46546480a8b191bc6df065e49f3c22d9bc894b3809ccea746cf025709a36ea69748f593b98b951088041aeaaf89c090e5b07e58557ca7fd86c8f762bf81f83d0ae92964bb38eb020d425696ad1116adc8c286ee8fd879693c3f8e806104b9476bbd700d40833e244ca2004224951c69eec52b6e82fab4647eee872891d04c1cec93d56ea277ad5cd349e64d4bae1dfd65c812a7690236c84b28036ee62552c779b3d4f7525aca67e1cda163f069a4bce2a460e37e06c4a5a3f6945f644212963f81114230fbf37c64fbc00eb770eafd1a14347bd9e908d1e4530cfd628ad1ef7bdf934d9ef40b5d65ab4e14cd5d5f55d8737ba36bee3d710f00848987fbb8565c0a9c0dc939f0f07d154c1ad0811e82d7993daec8ce3e7d25e08dd70f1e6b8f0dc3618adc83137d9c77a4ad2e68fd6e750b809b93ca952034da693bfd44180735606c1daafe97ef4aefb82ca69c09329fbd5728299776dd0ef2fe84f2be3bc7a4ee851f36c7274c2946db3ca821343ebe0f0df4d90365d237a1e93d0ed0c9656c7d14b841e2576c12715eae031e0fd54efa17ef4900ddb7e9536dcae95535756f8e99ee41e45b629db9bc209bfa696a04046d82cd51dcf9ce665f771926c6ca1f285c0cd7832b36d4bd0baf4592633c75259c65c20b3503c0df9325c365a24c170a0450
    ports:
      - "3001:3001"  # Your backend API will be on port 3001
    depends_on:
      - mongodb
    volumes:
      - ./backend:/app
      - /app/node_modules
    networks:
      - app_network

  # Frontend (React app) service
  frontend:
    build: ./front-end
    container_name: frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:3001  # Change the port to 3001 to match the backend
    ports:
      - "3000:3000"  # Your frontend will be on port 3000
    depends_on:
      - backend
    volumes:
      - ./front-end:/app
      - /app/node_modules  # This ensures node_modules stays inside the container
    networks:
      - app_network

networks:
  app_network:
    driver: bridge

volumes:
  mongodb_data:
